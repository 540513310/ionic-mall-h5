!function(){angular.module("ui.angularSku",[]).value("skuConfig",{splitStr:";"}).factory("utilService",["$log","skuConfig",function(t,e){var n={},r=[];return{filter:function(t,e){var n=[];return angular.forEach(t,function(t,r){e(t,r)&&n.push(t)}),n},getIndex:function(t){var e=-1;return angular.forEach(r,function(n,r){-1===e&&angular.forEach(n,function(n,i){t===n&&(e=r)})}),e},unique:function(t){for(var e=[],n={},r=0;r<t.length;r++)n[t[r]]||(e.push(t[r]),n[t[r]]=1);return e},getSkuList:function(n){var r=[];return n||t.error("input sku-data error!"),angular.forEach(n,function(t,n){r.push(n.split(e.splitStr))}),r},transpose:function(t){var e=t.length?t.length:0,n=t[0]instanceof Array?t[0].length:0;if(0===n||0===e)return[];var r,i,u=[];for(r=0;n>r;r++)for(u[r]=[],i=0;e>i;i++)u[r][i]=t[i][r];return u},getKeys:function(t){for(var e=this.getSkuList(t),n=this.transpose(e),i=[],u=0;u<n.length;u++)i[u]=this.unique(n[u]);return r=i},getKeysMap:function(t,i){var u;return angular.isDefined(n[t])?n[t]:(u=t.split(e.splitStr),void(u.length===r.length))},getNum:function(t,i){var u,a,l,o,s=0,c=[];if(angular.isDefined(n[t]))return n[t];if(o=t.split(e.splitStr),o.length===r.length)return i[t]?i[t].store_nums:0;for(u=0;u<r.length;u++){for(a=0;a<r[u].length&&o.length>0&&r[u][a]!=o[0];a++);if(!(a<r[u].length&&o.length>0)){for(l=0;l<r[u].length;l++)s+=this.getNum(c.concat(r[u][l],o).join(e.splitStr),i);break}c.push(o.shift())}return n[t]=s,s}}}]).directive("uiSku",["$log","skuConfig","utilService",function(t,e,n){return{restrict:"A",transclude:!0,scope:{splitStr:"@",initSku:"@",onOk:"&",skuData:"=",specMap:"="},controller:["$scope","$element","$attrs",function(t,e,n){this.checkIn=function(e){t.initSelect(e)}}],link:function(r,i,u,a,l){r.splitStr&&(e.splitStr=r.splitStr),r.keyMap={},r.selected=[],r.keys=n.getKeys(r.skuData),angular.forEach(r.keys,function(t,e){angular.forEach(t,function(t,e){r.keyMap[t]={name:t,selected:!1,disabled:!1}})}),l(r,function(t){i.append(t)}),r.initSelect=function(n){var i=n.split(e.splitStr);0==i.length&&t.error("input init-sku is undefiend!"),angular.forEach(i,function(t,e){r.onSelect(t)})},r.onSelect=function(t){var e=r.keyMap,i=[];e[t].disabled||(r.checkItem(t),i=n.filter(r.selected,function(t,e){return angular.isDefined(t)}),r.onOk({$event:r.skuData[r.selected.join("#")],key:t}))},r.checkItem=function(i){var u=r.keyMap,a=[],l=[],o=n.getIndex(i);return-1===o?void t.error("key is undefiend!"):(r.selected[o]=r.selected[o]===i?void 0:i,void angular.forEach(r.keys,function(t,s){angular.copy(r.selected,a),angular.forEach(t,function(t,c){s===o&&(u[t].selected=i===t?!u[t].selected:!1),s===o||u[t].selected||(a[s]=t,l=n.filter(a,function(t,e){return angular.isDefined(t)}),u[t].disabled=n.getNum(l.join(e.splitStr),r.skuData)>0?!1:!0)})}))},r.initSku&&r.initSelect(r.initSku)}}}])}();
(function(){angular.module("ionicRating",[]).constant("ratingConfig",{max:5,stateOn:5,stateOff:null}).controller("RatingController",["$scope","$attrs","ratingConfig",function(e,t,n){var a;return a={$setViewValue:angular.noop},this.init=function(r){var i,l;return a=r,a.$render=this.render,this.stateOn=angular.isDefined(t.stateOn)?e.$parent.$eval(t.stateOn):n.stateOn,this.stateOff=angular.isDefined(t.stateOff)?e.$parent.$eval(t.stateOff):n.stateOff,i=angular.isDefined(t.max)?e.$parent.$eval(t.max):n.max,l=angular.isDefined(t.ratingStates)?e.$parent.$eval(t.ratingStates):new Array(i),e.range=this.buildTemplateObjects(l)},this.buildTemplateObjects=function(e){var t,n,a,r;for(r=e.length,n=0,a=r.length;a>n;n++)t=r[n],e[t]=angular.extend({index:1},{stateOn:this.stateOn,stateOff:this.stateOff},e[t]);return e},e.rate=function(t){return!e.readonly&&t>=0&&t<=e.range.length?(a.$setViewValue(t),a.$render()):void 0},e.reset=function(){return e.value=a.$viewValue,e.onLeave()},e.enter=function(t){return e.readonly||(e.value=t),e.onHover({value:t})},e.onKeydown=function(t){return/(37|38|39|40)/.test(t.which)?(t.preventDefault(),t.stopPropagation(),e.rate(e.value+(38===t.which||39===t.which?{1:-1}:void 0))):void 0},this.render=function(){return e.value=a.$viewValue},this}]).directive("rating",function(){return{restrict:"EA",require:["rating","ngModel"],scope:{readonly:"=?",onHover:"&",onLeave:"&"},controller:"RatingController",template:'<ul class="rating" ng-mouseleave="reset()" ng-keydown="onKeydown($event)"><li ng-repeat="r in range track by $index" ng-click="rate($index + 1)"><i class="icon ion-ios-star" ng-class="$index < value && (r.stateOn || \'active\') || (r.stateOff || \'dark\')"></i></li></ul>',replace:!0,link:function(e,t,n,a){var r,i;return i=a[0],r=a[1],r?i.init(r):void 0}}})}).call(this);
angular.module("xgStore",["ionic","xgStore.controllers","xgStore.directives","xgStore.services","ui.angularSku","ngAnimate","angularLazyImg","ionicRating","pasvaz.bindonce","angulartics","angulartics.baidu","ngIOS9UIWebViewPatch"]).config(["$analyticsProvider",function(t){t.firstPageview(!0),t.withAutoBase(!0)}]).run(["$rootScope","$location","$state","$ionicHistory","$ionicNavBarDelegate","xgUser","$ionicPopup","$ionicLoading",function(t,e,r,o,l,a,i,n){var s=e.search();t.paramsGroup={platform2:s.platform||"",platform_version:s.platform_version||"",device_id:s.device_id||"",channel:s.channel||"",app_version:s.app_version||""},t.entry=e.search().entry||"goods",t.sdk=e.search().sdk||19,t.returnMobile=function(){Ponto.invoke("H5ToMobileRequest","returnMobile",{entry:t.entry,msg:{}},null,null)},t.modelGroup=[],t.paymentSuccess=function(e){r.go("orderList",{reload:!0,replace:!0}).then(function(){o.clearHistory(),l.showBackButton(!1),t.showBtns.returnMobile=!0;var e=i.alert({title:'支付成功  <span class="status"></span>',template:"亲, 订单已成功支付,</br> 请耐心等待吧!",cssClass:"payment-success-popup",okText:"确定",okType:"button button-outline button-positive"});e.then(function(e){t.reloadOrderList()})})},t.paymentFailure=function(e){r.go("orderList",{reload:!0,replace:!0}).then(function(){o.clearHistory(),l.showBackButton(!1),t.showBtns.returnMobile=!0;var r=i.confirm({title:'支付失败 <span class="status"></span>',cssClass:"payment-failure-popup",template:"亲, 该订单支付失败, </br>请重新支付!",cancelText:"取消",cancelType:"button button-outline button-dark",okText:"去支付",okType:"button button-outline button-positive"});r.then(function(t){if(1==t){var r={order_str:e.order_str,pay_type:e.pay_type};Ponto.invoke("H5ToMobileRequest","payment",r,null,null)}})})},t.showBtns={cart:!1,editAble:!1,addressAdd:!1,addressSave:!1,quitAble:!1,returnMobile:!1},t.editAllState=!1,t.showAlert=function(t,e){n.show({template:t,duration:e,noBackdrop:!0})},t.gotoShopCart=function(){a.getSessionId().then(function(t){r.go("shoppingCart")})},t.goStateBack=function(){return t.modelGroup.length>0?void t.modelGroup.pop().hide():void(o.backView()?o.goBack():""!==t.entry&&t.returnMobile())}}]).config(["$ionicConfigProvider",function(t){var e={views:{maxCache:3,forwardCache:!0,transition:"ios"},navBar:{alignTitle:"center",positionPrimaryButtons:"ios",positionSecondaryButtons:"ios",transition:"ios"},backButton:{icon:"ion-ios-arrow-left",text:" ",previousTitleText:!1},form:{checkbox:"ios"},tabs:{style:"striped",position:"top"},templates:{}},r={views:{maxCache:3,forwardCache:!0,transition:"none"},navBar:{alignTitle:"center",positionPrimaryButtons:"ios",positionSecondaryButtons:"ios",transition:"none"},backButton:{icon:"ion-ios-arrow-left",text:" ",previousTitleText:!1},form:{checkbox:"ios"},tabs:{style:"striped",position:"top"},templates:{},scrolling:{jsScrolling:!1}};t.setPlatformConfig("android",r),t.setPlatformConfig("ios",e)}]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("product",{url:"/product/:id",templateUrl:"templates/product/detail.html",controller:"productCtrl"}).state("product4",{url:"/product4/:id",templateUrl:"templates/product/detail.html",controller:"productCtrl"}).state("mall",{url:"/mall/:id",templateUrl:"templates/mall/index.html",controller:"mallCtrl"}).state("mallConnect",{url:"/mall/connect/:id",templateUrl:"templates/mall/connect.html",controller:"mallConnectCtrl"}).state("productPreview",{url:"/product/preview/:id",templateUrl:"templates/product/preview.html",controller:"productCtrl"}).state("shoppingCart",{url:"/shopping/cart",cache:!1,templateUrl:"templates/shopping/cart.html",controller:"cartCtrl"}).state("addressEdit",{url:"/address/edit/:id",templateUrl:"templates/address/edit.html",controller:"addressEditCtrl"}).state("addressList",{url:"/address/list",templateUrl:"templates/address/list.html",controller:"addressListCtrl"}).state("orderCheck",{url:"/order/check/:goodsIdList/:productIdList/:quantityList/:defaultAddressId",templateUrl:"templates/order/check.html",controller:"orderCheckCtrl"}).state("orderList",{url:"/order/list",params:{popup_type:null,order_str:null,pay_type:null},templateUrl:"templates/order/list.html",controller:"orderListCtrl"}).state("orderDetail",{url:"/order/detail/:id",cache:!1,templateUrl:"templates/order/detail.html",controller:"orderDetailCtrl"}).state("orderGrade",{url:"/order/grade/:id",cache:!1,templateUrl:"templates/order/grade.html",controller:"orderGradeCtrl"}).state("deliveryTrace",{url:"/delivery/trace/:id",templateUrl:"templates/delivery/trace.html",controller:"deliveryTraceCtrl"}).state("refundApply",{url:"/refund/apply/:order_id/:order_goods_id",templateUrl:"templates/refund/apply.html",controller:"refundApplyCtrl"}).state("refundDetail",{url:"/refund/detail/:order_id/:goods_id/:product_id",templateUrl:"templates/refund/detail.html",controller:"refundDetailCtrl"}),e.otherwise("/product/166")}]);
angular.module("xgStore.controllers",[]).controller("AppCtrl",["$scope","$rootScope","$ionicLoading","xgUser","$state",function(o,e,l,n,r){console.log("App index")}]);
angular.module("xgStore.services",[]).service("sku",function(){var t=[],e=function(e){t.push(e)},n=function(){return t};return{setInfo:e,getInfo:n}}).service("xgCart",["xgApi","$state","$location","xgAddress",function(t,e,n,r){this.init=function(t){angular.forEach(t,function(t,e){angular.forEach(t,function(t,e){t.selected=!1,t.editNow=!1,t.seller.selected=!1})}),this.cartItems=t},this.getStoreId=function(){var t=[];return angular.forEach(this.cartItems,function(e,n){t.push(n)}),t},this.getItems=function(t){var e=this.cartItems[t],n=0;return angular.forEach(e,function(t,e){1==t.is_valid&&(n+=parseInt(t.cart.quantity))}),n},this.getStoreTotal=function(t){var e=this.cartItems[t],n=0;return angular.forEach(e,function(t,e){1==t.is_valid&&(n+=t.goods.sell_price*t.cart.quantity)}),n.toFixed(2)},this.getCartTotal=function(){var t=0,e=this;return angular.forEach(e.cartItems,function(n,r){t+=parseFloat(e.getStoreTotal(r),2)}),t},this.getCheckoutTotal=function(){var t={total:0,selected:0};return angular.forEach(this.cartItems,function(e,n){t[n]={total:0,selected:0},angular.forEach(e,function(e,r){t[n].total+=1,1==e.selected&&(t[n].selected+=1,1==e.is_valid&&(t.selected+=1,t.total+=e.cart.quantity*e.goods.sell_price))})}),t},this.getStoreAllState=function(){var t=Object.keys(this.cartItems).length,e=0;return angular.forEach(this.cartItems,function(t,n){var r=0,i=t.length;angular.forEach(t,function(t,n){t.editNow&&r++,r==i&&e++})}),t==e&&t>0?!0:!1},this.selectAll=function(t){var e=this.getStoreId(),n=this;angular.forEach(e,function(e,r){n.selectStore(e,t)})},this.selectStore=function(t,e){var n=this.cartItems[t];e=null==e?n[0].seller.selected:!e,angular.forEach(n,function(t,n){e?(t.selected=!1,t.seller.selected=!1):(t.selected=!0,t.seller.selected=!0)})},this.checkoutNow=function(){var t={},e=[],i=[],a=[],o=r.getDefault().address_id||0;angular.forEach(this.cartItems,function(t,n){angular.forEach(t,function(t){1==t.selected&&1==t.is_valid&&(e.push(t.cart.goods_id),i.push(t.cart.product_id),a.push(t.cart.quantity))})}),t.goods_id_list=e.join(","),t.product_id_list=i.join(","),t.quantity_list=a.join(","),(""!==t.goods_id_list||""!==t.product_id_list||""!==t.quantity_list)&&n.path("/order/check/"+t.goods_id_list+"/"+t.product_id_list+"/"+t.quantity_list+"/"+o)}}]).filter("displaySale",function(){return function(t,e){if(isNaN(parseFloat(t)))return"";e="undefined"==typeof e?".":",",t=Math.round(100*parseFloat(t))/100;var n=t.toString().split(".");return 1===n.length?t+e+"00":n[1].length<2?t+"0":t}}).filter("formatPrice",function(){return function(t,e,n,r,i){var a;e="undefined"==typeof e?2:e,i="undefined"==typeof i?!0:i,n="undefined"==typeof n?".":n,r="undefined"==typeof r?",":r,t=t.toString();var o=t.split("."),s="undefined"==typeof o[1]?"00":o[1];if(i&&0===parseInt(s,10))s="-";else for(s=s.toString(),s.length>e&&(s=Math.round(parseFloat("0."+s)*Math.pow(10,e)).toString()),a=s.length;e>a;a++)s+="0";var c=o[0],l="",u=0;for(a=c.length-1;a>-1;a--)l=(u++%3===2&&a>0?n:"")+c.substr(a,1)+l;return l+r+s}});
angular.module("xgStore.controllers").controller("areaCtrl",["$scope","$http","$stateParams","$ionicPopover","$location","xgApi","xgAddress","xgUser",function(e,o,s,t,a,i,d,r){e.areaList={},e.chooseStep=0,e.chooseStepObjList=[],e.updateBindAreaList=function(o){i.requestApi("/api/area/find",{parent_id:o}).then(function(o){e.areaList=o})},e.updateBindAreaList(0),e.chooseArea=function(o,s){e.chooseStep++,(1==e.chooseStep||2==e.chooseStep)&&(e.chooseStepObjList.push({id:o,name:s}),e.updateBindAreaList(o)),3==e.chooseStep&&(e.chooseStepObjList.push({id:o,name:s}),e.address.province=e.chooseStepObjList[0].id,e.address.city=e.chooseStepObjList[1].id,e.address.area=e.chooseStepObjList[2].id,e.address.address_area=e.chooseStepObjList[0].name+" "+e.chooseStepObjList[1].name+" "+e.chooseStepObjList[2].name,e.modal.hide())},e.hideModal=function(){e.modal.hide()}}]);
angular.module("xgStore.controllers").controller("addressCheckCtrl",["$scope","$rootScope","$state","$stateParams","$ionicLoading","xgUser","xgApi","$timeout","xgAddress","$ionicHistory","$ionicPopup",function(e,t,s,n,o,d,r,i,a,u,l){r.requestApi("/api/user/detail",{}).then(function(t){e.userInfo=t}),e.setDefault=function(t){d.getSessionId().then(function(){var s=e.userInfo.address_list,n={};return angular.forEach(s,function(e){e.address_id==t&&(n=e)}),n["default"]=1,r.requestApi("/api/address/edit",n)}).then(function(t){e.userInfo=t,o.show({template:"设置成功",noBackdrop:!0,duration:1e3})})},e.deleteAddress=function(t){var s=l.confirm({title:"删除收货地址",cssClass:"remove-order-popup",subTitle:"确认删除该收货地址？",cancelText:"取消",cancelType:"button button-outline button-dark",okText:"确定",okType:"button button-outline button-positive"});s.then(function(s){1==s&&d.getSessionId().then(function(){return r.requestApi("/api/address/delete",{address_id:t})}).then(function(t){e.userInfo=t,e.userInfo.address_list.length<=0&&(e.defaultAddress.address_id=0),o.show({template:"删除成功",noBackdrop:!0,duration:1e3})})})},t.addressSave=function(){d.getSessionId().then(function(){var t=e.address;return t["default"]=1==t["default"]?1:0,r.requestApi("/api/address/edit",t)}).then(function(t){e.userInfo.address_list=t.address_list,a.init(t.address_list),1==t.address_list.length&&e.defaultChooseAddress(t.address_list.address_id),o.show({template:"保存成功",noBackdrop:!0,duration:1e3}),i(e.closeNewAddress(),1500)},function(e){o.show({template:e,noBackdrop:!0,duration:1e3})})}}]);
angular.module("xgStore.controllers").controller("addressEditCtrl",["$scope","$stateParams","$ionicLoading","$rootScope","$location","xgApi","xgUser","$ionicModal","$timeout",function(e,o,t,a,s,n,d,r,i){e.id=o.id,e.address={},e.$on("$ionicView.beforeEnter",function(){a.showBtns.addressSave=!0}),e.$on("$ionicView.beforeLeave",function(){a.showBtns.addressSave=!1}),n.requestApi("/api/user/detail",{}).then(function(o){e.userInfo=o;var t=e.userInfo.address_list;angular.forEach(t,function(o){o.address_id==e.id&&(e.address=o,e.address["default"]=1==e.address["default"]?!0:!1)})}),a.addressSave=function(){d.getSessionId().then(function(){var o=e.address;return o["default"]=1==o["default"]?1:0,n.requestApi("/api/address/edit",o)}).then(function(e){t.show({template:"保存成功",noBackdrop:!0,duration:1e3}),s.path("/address/list")},function(e){t.show({template:e,noBackdrop:!0,duration:1e3})})},e.popupChooseArea=function(){r.fromTemplateUrl("templates/address/area.html",{scope:e}).then(function(o){e.modal=o,i(function(){e.modal.show()},50)})}}]);
angular.module("xgStore.controllers").controller("addressListCtrl",["$scope","$rootScope","$state","$stateParams","$ionicLoading","xgUser","xgApi","$location","$ionicHistory","$ionicPopup",function(e,t,n,o,s,r,i,d,a,u){function c(){i.requestApi("/api/user/detail",{}).then(function(t){e.userInfo=t})["finally"](function(){e.$broadcast("scroll.refreshComplete")})}e.userInfo={},e.$on("$ionicView.beforeEnter",function(){t.showBtns.addressAdd=!0,"address"==t.entry&&(t.showBtns.returnMobile=!0),e.doRefresh()}),e.$on("$ionicView.beforeLeave",function(){t.showBtns.addressAdd=!1,"address"==t.entry&&(t.showBtns.returnMobile=!1)}),e.doRefresh=function(){r.getSessionId().then(function(){"address"==t.entry&&Ponto.invoke("H5ToMobileRequest","hideNativeNavBar",{},null,null),c()})},e.setDefault=function(t){r.getSessionId().then(function(){var n=e.userInfo.address_list,o={};return angular.forEach(n,function(e){e.address_id==t&&(o=e)}),o["default"]=1,i.requestApi("/api/address/edit",o)}).then(function(t){e.userInfo=t,s.show({template:"设置成功",noBackdrop:!0,duration:1e3})})},e.deleteAddress=function(t){var n=u.confirm({title:"删除收货地址",cssClass:"remove-order-popup",subTitle:"确认删除该收货地址？",cancelText:"取消",cancelType:"button button-outline button-dark",okText:"确定",okType:"button button-outline button-positive"});n.then(function(n){1==n&&r.getSessionId().then(function(){return i.requestApi("/api/address/delete",{address_id:t})}).then(function(t){e.userInfo=t,s.show({template:"删除成功",noBackdrop:!0,duration:1e3})})})},e.chooseAddress=function(e){if(null!==a.backView()&&"orderCheck"==a.backView().stateName){var t=a.backView().stateParams;t.defaultAddressId=e,n.go("orderCheck",t)}}}]);
angular.module("xgStore.controllers").controller("addressNewCtrl",["$scope","$stateParams","$ionicLoading","$rootScope","$location","$timeout","xgApi","xgUser","$ionicModal",function(o,e,t,n,a,r,i,l,s){i.requestApi("/api/user/detail",{}).then(function(e){o.userInfo=e}),o.popupChooseArea=function(){s.fromTemplateUrl("templates/address/area.html",{scope:o}).then(function(e){o.modal=e,r(function(){o.modal.show()},50)})}}]);
angular.module("xgStore.controllers").controller("cartCtrl",["$scope","$http","$rootScope","$ionicModal","$timeout","xgCart","xgApi","xgAddress","xgUser","$state",function(t,e,o,r,c,n,a,i,u,d){t.xgCart=n,t.xgAddress=i,t.checkout={selected:0,total:0,allSelected:!1},t.cartItems={},t.$on("$ionicView.beforeEnter",function(){o.showBtns.editAble=!0,"cart"==o.entry&&(o.showBtns.returnMobile=!0)}),t.$on("$ionicView.beforeLeave",function(){o.showBtns.editAble=!1,"cart"==o.entry&&(o.showBtns.returnMobile=!1)}),t.$on("$stateChangeStart",function(){t.modal&&t.modal.hide()}),t.taobaoCart=function(){Ponto.invoke("H5ToMobileRequest","taobaoCart",{},null,null)},t.gotoProductDetail=function(t){o.sdk>=19?d.go("product",{id:t}):d.go("product4",{id:t})},u.getSessionId().then(function(){return"cart"==o.entry&&Ponto.invoke("H5ToMobileRequest","hideNativeNavBar",{},null,null),a.requestApi("/api/cart/rows",{})}).then(function(e){Object.keys(e).length>0?(t.cartItems=e,t.cartEmpty=!1):t.cartEmpty=!0,n.init(e)}).then(function(){t.$watch("cartItems",function(e){var r=n.getCheckoutTotal(),c=n.getStoreId().length;angular.forEach(r,function(e,o){"object"==typeof e&&e.total==e.selected?(c--,angular.forEach(t.cartItems[o],function(t,e){t.seller.selected=!0})):angular.forEach(t.cartItems[o],function(t,e){t.seller.selected=!1})}),o.editAllState=n.getStoreAllState(),t.checkout=n.getCheckoutTotal(),t.checkout.allSelected=0==c?!0:!1,t.cartEmpty=0==Object.keys(e).length?!0:!1},!0)}).then(function(){a.requestApi("/api/user/detail",{}).then(function(t){i.init(t.address_list)})}),t.toggleEdit=function(e){angular.forEach(t.cartItems[e],function(t){t.editNow=t.editNow?!1:!0})},o.toggleEditAll=function(){angular.forEach(t.cartItems,function(t){angular.forEach(t,function(t,e){t.editNow=o.editAllState?!1:!0})})},t.skuFromCart=!0,t.changeSku=function(e,r){angular.forEach(t.cartItems[e],function(c,n){r==n&&(o.buyNow=3,t.editStoreId=e,t.editCartId=t.cartItems[e][n].cart.id,t.productInfo=t.cartItems[e][n].goods,t.specArray=JSON.parse(t.productInfo.spec_array),t.editGoodsId=t.productInfo.id,t.editProductId=c.cart.product_id,0==c.cart.product_id?(t.productInfo.current_price=c.goods.sell_price,t.productInfo.current_store_nums=c.goods.store_nums):angular.forEach(c.goods.product_list,function(e,o){e.id==c.cart.product_id&&(t.productInfo.current_price=e.sell_price,t.productInfo.current_store_nums=e.store_nums)}))}),t.showSku()},t.showSku=function(){a.requestApi("api/goods/sku",{goods_id:t.editGoodsId}).then(function(e){t.initSku=t.productInfo.product_list[t.editProductId].spec_current,t.skuInfo=e.sku_map,t.specMap=e.spec_map,t.specImgMap=e.spec_img_map,t.multiple=!0}).then(function(){r.fromTemplateUrl("templates/product/sku.html",{scope:t}).then(function(e){t.modal=e}).then(function(){c(function(){t.modal.show(),o.modelGroup.push(t.modal)},50)})})},t.cartChange=function(e){angular.forEach(t.cartItems[t.editStoreId],function(t,o){if(e.id==t.cart.id){t.cart.quantity=e.quantity,t.cart.product_id=e.product_id;var r=t.goods.product_list;console.log(t),console.log(e),angular.forEach(r,function(o,r){r==e.product_id&&(t.goods.sell_price=o.sell_price,t.goods.current_img=e.currentImg)})}}),t.showAlert("编辑成功",1e3)},t.closeSku=function(){o.modelGroup.pop().hide()},t.addItem=function(e,o,r){angular.forEach(t.cartItems[e],function(t,e){if(e==o){t.cart.quantity=parseInt(t.cart.quantity)+r;var c={id:t.cart.id,goods_id:t.cart.goods_id,product_id:t.cart.product_id,quantity:t.cart.quantity};a.requestApi("/api/cart/edit",c).then(function(t){})}})},t.delCartItem=function(e,o){angular.forEach(t.cartItems[e],function(r,c){if(c==o){var n={cart_id:r.cart.id};a.requestApi("/api/cart/delete",n).then(function(o){t.cartItems[e].splice(c,1),0==t.cartItems[e].length&&delete t.cartItems[e]})}})}}]);
angular.module("xgStore.controllers").controller("deliveryTraceCtrl",["$scope","$stateParams","$ionicLoading","$rootScope","$location","xgApi","xgUser",function(e,r,o,t,i,n,d){e.order_id=r.id,d.getSessionId().then(function(){return n.requestApi("/api/delivery/trace",{order_id:e.order_id})}).then(function(r){e.data=r})}]);
angular.module("xgStore.controllers").controller("mallConnectCtrl",["xgApi","$scope","$sce","$stateParams",function(e,r,t,l){e.requestApi("/api/seller/home",{seller_id:l.id}).then(function(e){r.mall=e}),r.trustSrc=function(e){return t.trustAsResourceUrl(e)}}]);
angular.module("xgStore.controllers").controller("mallCtrl",["xgApi","$scope","$rootScope","$stateParams",function(l,e,o,r){l.requestApi("/api/seller/home",{seller_id:r.id}).then(function(l){e.mall=l,console.log(l)})}]);
angular.module("xgStore.controllers").controller("orderCheckCtrl",["$scope","$rootScope","$location","$state","$stateParams","$ionicModal","xgApi","xgCart","xgAddress",function(t,e,d,s,o,r,a,i,n){d.search("entry",null),t.xgCart=i,t.xgAddress=n,t.postscript={},t.$on("$ionicView.beforeEnter",function(){t.paymentState=!0;var e={goods_id_list:o.goodsIdList,product_id_list:o.productIdList,quantity_list:o.quantityList};a.requestApi("/api/order/check",e).then(function(e){t.orderCheck=e,t.CartStructure=e.cart_structure,t.payAmount=u(),i.init(t.CartStructure),n.init(t.orderCheck.address_list)}).then(function(){t.defaultAddress=n.getDefault(o.defaultAddressId)})}),t.pay={method:100001},r.fromTemplateUrl("templates/address/check.html",{scope:t}).then(function(e){t.addressModal=e}),t.getAddress=function(){e.modelGroup.push(t.addressModal),t.addressModal.show()},t.closeAddress=function(){e.modelGroup.pop(),t.addressModal.hide()},t.closeNewAddress=function(){e.modelGroup.pop(),t.addressNewModal.hide()},r.fromTemplateUrl("templates/address/new.html",{scope:t}).then(function(e){t.addressNewModal=e}),t.newAddress=function(d){t.address=n.edit(d),t.addressNewModal.show(),e.modelGroup.push(t.addressNewModal)},t.chooseAddress=function(e){t.defaultAddress=n.getDefault(e),t.closeAddress()},t.defaultChooseAddress=function(e){t.defaultAddress=n.getDefault(e)};var u=function(){var e=0,d={goods_id_list:[],product_id_list:[],quantity_list:[]};return angular.forEach(t.CartStructure,function(t,s){var o=0;angular.forEach(t,function(t,e){t.is_valid&&(o+=t.goods.sell_price*t.cart.quantity,d.goods_id_list.push(t.cart.goods_id),d.product_id_list.push(t.cart.product_id),d.quantity_list.push(t.cart.quantity))}),e+=o}),t.paymentState=0==e?!0:!1,d.goods_id_list=d.goods_id_list.join(","),d.product_id_list=d.product_id_list.join(","),d.quantity_list=d.quantity_list.join(","),t.orderValidCheckParams=d,e.toFixed(2)};t.payment=function(){t.paymentState=!0;var e=t.orderValidCheckParams;return e.address_id=t.defaultAddress.address_id,e.pay_type=t.pay.method,e.postscript=t.postscript,0==e.address_id?(t.showAlert("请填写收货地址",1e3),void(t.paymentState=!1)):void a.requestApi("/api/order/submit",e).then(function(t){Ponto.invoke("H5ToMobileRequest","payment",t,null,null)})},t.gotoProductDetail=function(t){e.sdk>=19?s.go("product",{id:t}):s.go("product4",{id:t})}}]);
angular.module("xgStore.controllers").controller("orderDetailCtrl",["$scope","$http","$stateParams","$rootScope","$ionicLoading","$location","xgUser","xgApi","$ionicPopup","$state",function(o,e,r,t,n,i,d,a,s,l){o.order_id=r.id,o.order={},o.order.lastDelivery="",o.$on("$ionicView.beforeEnter",function(){o.doRefresh()}),o.doRefresh=function(){d.getSessionId().then(function(){return a.requestApi("/api/order/detail",{order_id:o.order_id})}).then(function(e){return console.log(e),e.total_goods_price=0,e.regiment&&e.regiment.store_nums&&(e.regiment.success=parseInt(e.regiment.store_nums,10)>parseInt(e.regiment.sum_count,10)?!1:!0),angular.forEach(e.order_goods_list,function(o){o.goods_array=angular.fromJson(o.goods_array),e.total_goods_price+=o.real_price*o.goods_nums}),o.order=e,e.regiment&&(o.productInfo=o.order.order_goods_list[0]),o.displayPayBtn=0==o.order.pay_status&&1==o.order.status?!0:!1,a.requestApi("/api/delivery/trace",{order_id:o.order_id})}).then(function(e){0!=e.length&&(o.order.lastDelivery=e[0].traces[e[0].traces.length-1])})["finally"](function(){o.$broadcast("scroll.refreshComplete")})},o.returnMobile=function(){t.returnMobile()},o.gotoProductDetail=function(o){t.sdk>=19?l.go("product",{id:o}):l.go("product4",{id:o})},o.gotoPayment=function(o){a.requestApi("/api/order/clickPay",{order_id:o,pay_type:100001}).then(function(o){Ponto.invoke("H5ToMobileRequest","payment",o,null,null)},function(o){n.show({template:o,noBackdrop:!0,duration:1e3})})},o.gotoRefundApply=function(o,e,r){l.go("refundApply",{order_id:o,order_goods_id:e}),r.stopPropagation()},o.gotoRefundDetail=function(o,e,r,t){l.go("refundDetail",{order_id:o,goods_id:e,product_id:r},{reload:!0}),t.stopPropagation()},o.showShare=function(){var e={title:o.productInfo.goods_array.name,desc:o.productInfo.goods_array.name,link:"http://app.mall.jpjie.com/#/product/"+o.productInfo.goods_id+"?is_share=1",img:o.productInfo.img};Ponto.invoke("H5ToMobileRequest","popupShareView",e,null,null)},o.contactQQ=function(){var e={qq:o.order.seller.server_num,ios_msg:"未安装 QQ 无法打开",android_msg:"未安装 QQ 无法打开"};Ponto.invoke("H5ToMobileRequest","qqChat",e,null,null)}}]);
angular.module("xgStore.controllers").controller("orderGradeCtrl",["$scope","$http","$stateParams","$rootScope","$ionicLoading","$location","xgUser","xgApi","$ionicPopup","$state",function(t,n,e,o,i,r,s,c,a,u){t.order_no=e.id,t.order={},t.order.lastDelivery="",t.max=5,t.$on("$ionicView.beforeEnter",function(){t.doRefresh()}),t.doRefresh=function(){s.getSessionId().then(function(){return c.requestApi("/api/comment/rows",{order_no:t.order_no})}).then(function(n){t.commentList=n})},t.submitGrade=function(){var n=[],e=!1;angular.forEach(t.commentList,function(o){if(0==o.status){var i={};i.id=o.id,i.quality_point=o.quality_point,i.speed_point=o.speed_point,i.service_point=o.service_point,i.content=o.content,n.push(i),o.content&&o.content.toString().length>300&&(e=!0,t.showAlert("字段太长",1e3))}}),e||s.getSessionId().then(function(){return c.requestApi("/api/comment/submit",{json:JSON.stringify(n)})}).then(function(n){t.goStateBack()})}}]);
angular.module("xgStore.controllers").controller("orderListCtrl",["$scope","$http","$rootScope","$ionicLoading","$ionicTabsDelegate","$ionicNavBarDelegate","$state","$location","xgUser","xgApi","$ionicPopup","$stateParams","xgOrder",function(e,o,t,r,n,i,s,d,c,u,a,l,p){e.currentIndex=0,e.xgOrder=p,e.ordersList=p.ordersList,e.$on("$ionicView.beforeEnter",function(){("order"==t.entry||"goods"==t.entry||"cart"==t.entry)&&(t.showBtns.returnMobile=!0),t.reloadOrderList()}),e.$on("$ionicView.beforeLeave",function(){t.showBtns.returnMobile=!1,i.showBackButton(!0)}),e.taobaoOrder=function(){Ponto.invoke("H5ToMobileRequest","taobaoOrder",{},null,null)},t.reloadOrderList=function(){c.getSessionId().then(function(){"order"==t.entry&&Ponto.invoke("H5ToMobileRequest","hideNativeNavBar",{},null,null);var o={order_tab:e.currentIndex,page:1,init:!0};u.requestApi("/api/order/rows",o).then(function(t){p.init(t,o),e.ordersList=p.ordersList,console.log(e.ordersList),e.ordersList[o.order_tab].current=o.page+1})})},e.loadMore=function(o){c.getSessionId().then(function(){p.getOrderList({order_tab:o,page:e.ordersList[o].current}),e.ordersList=p.ordersList})["finally"](function(){e.$broadcast("scroll.infiniteScrollComplete")})},e.onTabSelected=function(o){e.currentIndex=o,c.getSessionId().then(function(){if(void 0!=e.ordersList[o]&&1==e.ordersList[o].more){var t={order_tab:o,page:e.ordersList[o].page||1};p.getOrderList(t),e.ordersList=p.ordersList,console.log("tab selected:"+o),console.log(e.ordersList)}})},e.buy=function(e){u.requestApi("/api/order/clickPay",{order_id:e,pay_type:100001}).then(function(e){Ponto.invoke("H5ToMobileRequest","payment",e,null,null)},function(e){r.show({template:e,noBackdrop:!0,duration:1e3})})},e.cancel=function(e,o){p.cancel(e,o)},e.confirm=function(e,o){var n=a.confirm({title:"确认收货",cssClass:"confirm-order-popup",subTitle:o+" 元",cancelText:"取消",cancelType:"button button-outline button-dark",okText:"确定",okType:"button button-outline button-positive"});n.then(function(o){1==o&&u.requestApi("/api/order/confirm",{order_id:e}).then(function(e){t.reloadOrderList(),r.show({template:e.msg,noBackdrop:!0,duration:1e3})},function(e){r.show({template:e,noBackdrop:!0,duration:1e3})})})},e.delivery=function(e){s.go("delivery.trace",{order_id:e})},e.rebuy=function(e){c.getSessionId().then(function(){return u.requestApi("/api/order/rebuy",{order_id:e})}).then(function(e){var o=e.goods_id_list+"/"+e.product_id_list+"/"+e.quantity_list+"/"+e.default_address_id;console.log(o),d.path("/order/check/"+o)})},e.remove=function(e){var o=a.confirm({title:"删除订单",cssClass:"remove-order-popup",subTitle:"确认删除订单? 删除后订单不可恢复",cancelText:"取消",cancelType:"button button-outline button-dark",okText:"确定",okType:"button button-outline button-positive"});o.then(function(o){1==o&&(p.remove(e),t.reloadOrderList())})},e.gotoOrderDetail=function(e){s.go("orderDetail",{id:e})}}]);
angular.module("xgStore.controllers").controller("productCtrl",["xgApi","$scope","$rootScope","$state","$http","$stateParams","$timeout","$window","$ionicModal","$ionicLoading","sku","$ionicSlideBoxDelegate","$ionicScrollDelegate",function(o,e,n,t,i,r,c,u,l,s,p,a,d){e.productInfo={is_del:0},e.multiple=!1,e.moreHide=!0,e.specArray=[],e.from="product",e.comments={list:[],more:!0,current:1},e.$on("$ionicView.beforeEnter",function(){n.showBtns.cart=!0,n.showBtns.quitAble=!0,"goods"==n.entry&&(n.showBtns.returnMobile=!0,"preview"!=n.entry&&Ponto.invoke("H5ToMobileRequest","hideNativeNavBar",{},null,null)),m()}),e.$on("$ionicView.beforeLeave",function(){n.showBtns.cart=!1,n.showBtns.quitAble=!1,"goods"==n.entry&&(n.showBtns.returnMobile=!1)}),e.$on("$stateChangeStart",function(){e.modal&&e.modal.hide()}),e.onScroll=function(){document.querySelector("ion-content").scrollTop>739};var m=function(){o.requestApi("/api/goods/detail",{goods_id:r.id}).then(function(o){if(console.log(o),o.regiment&&o.regiment.img&&o.photo_list.unshift(o.regiment.img),o.regiment&&o.regiment.store_nums&&(o.regiment.success=o.regiment.store_nums-o.regiment.sum_count>0?!1:!0),e.productInfo=o,a.update(),angular.element(document.querySelector(".slider-pager")).css("display","block"),"object"==typeof o.price_range&&!(o.price_range instanceof Array))for(var n in o.price_range){e.multiple=!0;break}e.initProduct()},function(o){e.productInfo.is_del=1})};e.callNativeSliderChange=function(){Ponto.invoke("H5ToMobileRequest","sliderChange",{},null,null),console.log("swipe")},e.initProduct=function(){1==e.multiple?e.specArray=JSON.parse(e.productInfo.spec_array):"",e.productInfo.current_price=e.multiple?e.productInfo.price_range.min_sell_price==e.productInfo.price_range.max_sell_price?e.productInfo.price_range.min_sell_price:e.productInfo.price_range.min_sell_price+"-"+e.productInfo.price_range.max_sell_price:e.productInfo.sell_price,e.productInfo.current_store_nums=e.productInfo.store_nums},e.loadComment=function(){o.requestApi("/api/comment/all",{goods_id:r.id,page:e.comments.current}).then(function(o){return 0==o.length?void(e.comments.more=!1):(o.length<20&&(e.comments.more=!1),e.comments.list=e.comments.list.concat(o),void e.comments.current++)})},e.isHalf=function(o){return o-parseInt(o,10)>0},e.loadMoreData=function(){e.loadComment(),o.requestApi("/api/goods/commend",{goods_id:r.id}).then(function(o){e.recommendList=o}),o.requestApi("/api/goods/guess",{goods_id:r.id}).then(function(o){e.guessList=o}),c(function(){e.moreHide=!1,c(function(){angular.element(document.querySelectorAll(".text-and-img-wrap img")).addClass("viewed")},100)},1e3)},e.addCart=function(){n.buyNow=1,e.showSku()},e.checkNow=function(){n.buyNow=2,e.showSku()},e.showSku=function(){o.requestApi("api/goods/sku",{goods_id:r.id}).then(function(o){e.skuInfo=o.sku_map,e.specMap=o.spec_map,e.specImgMap=o.spec_img_map}).then(function(){l.fromTemplateUrl("templates/product/sku.html",{scope:e}).then(function(o){e.modal=o}).then(function(){e.initProduct(),c(function(){e.modal.show(),n.modelGroup.push(e.modal)},50)})})},e.closeSku=function(){n.modelGroup.pop().hide()},e.showShare=function(){var o={title:e.productInfo.share_content.title,desc:e.productInfo.share_content.desc,link:e.productInfo.share_content.link,img:e.productInfo.share_content.img};Ponto.invoke("H5ToMobileRequest","popupShareView",o,null,null)},e.contactQQ=function(){var o={qq:e.productInfo.seller.server_num,ios_msg:"未安装 QQ 无法打开",android_msg:"未安装 QQ 无法打开"};Ponto.invoke("H5ToMobileRequest","qqChat",o,null,null)},e.showTip=function(){l.fromTemplateUrl("templates/product/tip.html",{scope:e}).then(function(o){e.modalTip=o}).then(function(){e.modalTip.show(),n.modelGroup.push(e.modalTip)})},e.closeTip=function(){n.modelGroup.pop().hide()},e.contactMall=function(){t.go("mallConnect")}}]);
angular.module("xgStore.controllers").controller("skuCtrl",["$scope","$rootScope","$http","$stateParams","$ionicPopover","$location","$analytics","xgApi","xgAddress","xgUser",function(t,e,o,i,r,n,d,u,c,s){t.xgAddress=c,t.item={quantity:1,id:0,goods_id:i.id,product_id:0},t.addItem=function(e){t.item.quantity=parseInt(t.item.quantity)+e},t.setCurrentProductInfo=function(e,o){t.item.product_id=0,angular.forEach(t.specImgMap,function(e,i){o==i&&(t.productCurrentImg=e,t.item.currentImg=e)}),e?(t.productSelected=e,t.item.product_id=e.product_id,t.productInfo.current_price=e.sell_price,t.productInfo.current_store_nums=e.store_nums):t.item.product_id=0},t.addToCart=function(e,o){return t.multiple&&0==t.item.product_id?void t.showAlert("请选择产品属性",1e3):isNaN(t.item.quantity)?void t.showAlert("请输入有效的数量",1e3):t.item.quantity<=0?void t.showAlert("请选择商品数量",1e3):t.item.quantity>t.productInfo.current_store_nums?void t.showAlert("库存不足",1e3):(e?t.item.id=e:"",o?t.item.goods_id=o:"",void s.getSessionId().then(function(){return d.eventTrack("product",{category:"addToCart",label:"addToCart2:"+t.item.goods_id}),u.requestApi("api/cart/edit",t.item)}).then(function(o){t.productInfo.cart_count=o.cart_count,e?t.cartChange(t.item):t.showAlert("添加成功",1e3),t.closeSku()},function(e){t.showAlert(e,1e3)}))},t.goCheckNow=function(){var e=0;return t.multiple&&0==t.item.product_id?void t.showAlert("请选择产品属性",1e3):isNaN(t.item.quantity)?void t.showAlert("请输入有效的数量",1e3):t.item.quantity<=0?void t.showAlert("请选择商品数量",1e3):t.item.quantity>t.productInfo.current_store_nums?void t.showAlert("库存不足",1e3):void s.getSessionId().then(function(){return u.requestApi("/api/user/detail",{})}).then(function(e){d.eventTrack("product",{category:"buyNow",label:"buyNow2:"+t.item.goods_id}),c.init(e.address_list)}).then(function(){t.closeSku(),e=c.getDefault().address_id||0,n.path("/order/check/"+t.item.goods_id+"/"+t.item.product_id+"/"+t.item.quantity+"/"+e)})}}]);
angular.module("xgStore.controllers").controller("refundApplyCtrl",["$scope","$stateParams","$ionicLoading","$rootScope","xgApi","xgUser","$ionicPopup","$ionicHistory","$state",function(o,e,n,t,r,i,d,u,a){var s=e.order_id,c=e.order_goods_id;o.form={order_id:s,order_goods_id:c,content:""},o.$on("$ionicView.beforeEnter",function(){o.doRefresh()}),o.doRefresh=function(){i.getSessionId().then(function(){return r.requestApi("/api/order/detail",{order_id:s})}).then(function(e){angular.forEach(e.order_goods_list,function(e){c==e.id&&(o.refundGood=e)})})},o.refundNow=function(){return 1==o.refundGood.is_send&&isNaN(o.form.type)?(n.show({template:"请选择退款类型",noBackdrop:!0,duration:1e3}),!1):isNaN(o.form.amount)||o.form.amount<=0?(n.show({template:"请输入有效退款金额",noBackdrop:!0,duration:1e3}),!1):0==o.form.content.length?(n.show({template:"请简单描述下退款原因",noBackdrop:!0,duration:1e3}),!1):void f()};var f=function(){i.getSessionId().then(function(){return console.log(o.form),r.requestApi("/api/refund/apply",o.form)}).then(function(o){p()},function(o){n.show({template:o,noBackdrop:!0,duration:1e3})})},p=function(){var o=d.alert({title:"亲, 您的退款已申请, 等待卖家处理!",cssClass:"refund-result-popup",inputType:"text",okText:"返回订单详情",okType:"button button-outline button-positive"});o.then(function(o){var e=u.backView();-1==e.url.indexOf("/refund/detail")?u.goBack():u.goBack(-2)})}}]);
angular.module("xgStore.controllers").controller("refundDetailCtrl",["$scope","$stateParams","$ionicLoading","$ionicActionSheet","$ionicHistory","$rootScope","xgApi","xgUser","$ionicPopup","$location","$timeout",function(o,e,r,i,t,d,n,s,u,c,_){o.order_id=e.order_id,o.goods_id=e.goods_id,o.product_id=e.product_id,o.order={},o.order_goods={},o.data={},o.logistics={no:""},o.$on("$ionicView.beforeEnter",function(){o.doRefresh()}),o.doRefresh=function(){s.getSessionId().then(function(){return n.requestApi("/api/order/detail",{order_id:o.order_id})}).then(function(e){return o.order=e,angular.forEach(e.order_goods_list,function(e){return e.goods_id==o.goods_id&&e.product_id==o.product_id?void(o.order_goods=e):void 0}),n.requestApi("/api/refund/detail",{order_id:o.order_id,goods_id:o.goods_id,product_id:o.product_id})}).then(function(e){o.data=e;var r=o.order_goods.real_price*o.order_goods.goods_nums;return o.data.origin_price=r.toFixed(2),1==e.type?n.requestApi("/api/refund/sales_return",{order_id:o.order_id,goods_id:o.goods_id,product_id:o.product_id}):void 0}).then(function(e){e&&(o.refundPlease=e,o.refundPlease.freight_company[0].selected=!0,o.selectedFreight=o.refundPlease.freight_company[0])})},o.showFreight=function(){i.show({buttons:o.refundPlease.freight_company,buttonClicked:function(e){return angular.forEach(o.refundPlease.freight_company,function(r,i){r.selected=!1,e==i&&(o.selectedFreight=r,r.selected=!0)}),!0}})},o.submitRefund=function(){return void 0==o.selectedFreight?(o.showAlert("请选择快递公司",1e3),!1):""==o.logistics.no?(o.showAlert("请填写物流单号",1e3),!1):void s.getSessionId().then(function(){return n.requestApi("/api/refund/sales_return_post",{order_id:o.order_id,goods_id:o.goods_id,product_id:o.product_id,logistics_company:o.selectedFreight.id,logistics_no:o.logistics.no})}).then(function(){o.doRefresh()})},o.cancelRefund=function(){var e=u.confirm({subTitle:"取消退款申请后，退款将关闭",cssClass:"refund-confirm",inputType:"text",cancelText:"不退款了",okText:"继续退款",okType:"button button-outline button-positive"});e.then(function(e){0==e&&s.getSessionId().then(function(){return n.requestApi("/api/refund/cancel_apply",{order_id:o.order_id,goods_id:o.goods_id,product_id:o.product_id})}).then(function(o){(o.status="success")&&t.goBack()})})},o.contactQQ=function(){var e={qq:o.order.seller.server_num,ios_msg:"未安装 QQ 无法打开",android_msg:"未安装 QQ 无法打开"};Ponto.invoke("H5ToMobileRequest","qqChat",e,null,null)}}]);
angular.module("xgStore.directives",[]).directive("tabs",["$ionicScrollDelegate",function(e){return{restrict:"E",transclude:!0,scope:{},controller:["$scope","$ionicScrollDelegate",function(e,t){var n=e.panes=[];e.select=function(e,t){angular.forEach(n,function(e){e.selected=!1}),e.selected=!0},this.addPane=function(t){0==n.length&&e.select(t,!0),n.push(t)},t.resize()}],template:'<div class="tab-able "><ul class="nav nav-tabs item"><li ng-repeat="pane in panes" ng-class="{active:pane.selected}"><a href="" ng-click="select(pane)">{{pane.title}}</a></li></ul><div class="tab-content" ng-transclude></div></div>',replace:!0}}]).directive("pane",function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(e,t,n,a){a.addPane(e)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}).filter("reverse",function(){return function(e){return e.slice().reverse()}}).filter("range",function(){return function(e,t){t=parseInt(t);for(var n=0;t>n;n++)e.push(n);return e}});
angular.module("xgStore.services").service("xgAddress",["xgApi",function(s){this.init=function(s){angular.forEach(s,function(s,t){s.choosed=!1}),this.addressList=s},this["default"]=function(s){angular.forEach(this.addressList,function(t,i){t.id==s&&(t["default"]=1),t["default"]=0})},this.getDefault=function(s){var t=null;return angular.forEach(this.addressList,function(i,a){null==s&&1==i["default"]&&(t=i),i.address_id==s&&(t=i)}),null==t&&(t={address_id:0}),t},this.edit=function(s){var t={};return angular.forEach(this.addressList,function(i,a){i.address_id==s&&(t=i)}),t["default"]=1==t["default"]?!0:!1,t},this.choose=function(s){angular.forEach(this.addressList,function(t,i){t.id==s&&(t.choosed=!0),t.choosed=0})}}]);
angular.module("xgStore.services").factory("xgApi",["$q","$http","$rootScope","$ionicLoading",function(e,t,o,a){var r=function(r,s){var n=e.defer();return s.platform="wap",angular.forEach(o.paramsGroup,function(e,t){s[t]=e}),void 0!=o.session_id&&(s.session_id=o.session_id),t.get(r,{params:s,timeout:8e3}).then(function(e){"success"==e.data.status?n.resolve(e.data.result):n.reject(e.data.message)},function(e){a.show({template:"目前网络状况不佳，请检查网络配置",noBackdrop:!0,duration:1e3})}),n.promise};return{requestApi:r}}]);
angular.module("xgStore.services").service("xgOrder",["xgApi","$ionicLoading","$timeout",function(t,r,o){this.ordersList=[],this.initOrderList=function(){this.ordersList=[{tabName:"全部",list:[],badge:0,current:1,more:!0},{tabName:"待付款",list:[],badge:0,current:1,more:!0},{tabName:"待发货",list:[],badge:0,current:1,more:!0},{tabName:"待收货",list:[],badge:0,current:1,more:!0},{tabName:"交易完成",list:[],badge:0,current:1,more:!0}]},this.init=function(t,r){r.init&&this.initOrderList();var e=this.ordersList,i=r.order_tab?r.order_tab:0;e[1].badge=t.wait_pay_count,e[2].badge=t.wait_send_goods_count,e[3].badge=t.wait_receive_goods_count,angular.forEach(t.order_list,function(t,r){t.total_goods_num=0,t.total_goods_price=0,angular.forEach(t.order_goods_list,function(r,o){r.goods_array=angular.fromJson(r.goods_array),t.total_goods_num+=r.goods_nums,t.total_goods_price+=r.real_price*r.goods_nums})}),e[i].list=e[i].list.concat(t.order_list),e[i].current=r.page?r.page+1:1,t.order_list.length<20&&o(function(){e[i].more=!1},1500),this.ordersList=e},this.getOrderList=function(r){var o=this;t.requestApi("/api/order/rows",r).then(function(t){t.order_list.length<20&&(o.ordersList[r.order_tab].more=!1),o.init(t,r)})},this.cancel=function(o,e){var i=this;t.requestApi("/api/order/cancel",{order_id:o}).then(function(t){var s=e?e:0;1==s?(angular.forEach(i.ordersList[0].list,function(t,r){t.id==o&&(t.status=3,t.status_tag="交易关闭")}),angular.forEach(i.ordersList[1].list,function(t,r){t.id==o&&(i.ordersList[1].list.splice(r,1),i.ordersList[1].badge=i.ordersList[1].badge-1)})):0==s&&(angular.forEach(i.ordersList[0].list,function(t,r){t.id==o&&(t.status=3,t.status_tag="交易关闭",i.ordersList[1].badge=i.ordersList[1].badge-1)}),angular.forEach(i.ordersList[1].list,function(t,r){t.id==o&&i.ordersList[1].list.splice(r,1)})),r.show({template:t.msg,noBackdrop:!0,duration:1e3})},function(t){r.show({template:t,noBackdrop:!0,duration:1e3})})},this.remove=function(o){t.requestApi("/api/order/delete",{order_id:o}).then(function(t){r.show({template:t.msg,noBackdrop:!0,duration:1e3})},function(t){r.show({template:t,noBackdrop:!0,duration:1e3})})}}]);
angular.module("xgStore.services").factory("xgUser",["$rootScope","$ionicLoading","$q",function(e,o,s){var i=function(){var i=s.defer();return Ponto.invoke("H5ToMobileRequest","getSessionId",{msg:{}},function(o){e.session_id=o.session_id,void 0!=e.session_id&&""!=e.session_id?i.resolve(o.session_id):i.reject("")},function(){o.show({template:"用户登录失败",noBackdrop:!0,duration:1e3}),i.reject("用户登录失败了")}),i.promise};return{getSessionId:i}}]);